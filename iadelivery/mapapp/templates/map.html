<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Pedidos</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body, html {
            margin: 0;
            padding: 0;
        }
        .truck-cards-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem; 
            justify-content: flex-start; /* Puedes usar center para centrar las tarjetas */
        }
        .truck-card {
            flex: 1 1 300px; 
        }
        #map {
            width: 70%;
            height: fit-content;
            margin: 2rem auto; /* Centra el mapa horizontalmente */
            border: 2px solid;
            
        }
    </style>
</head>
<body>
    <header class="p-3 bg-dark text-white">
        <h1 class="text-center">Distribución de Mercancias Perecederas</h1>
    </header>
    <div class="container-fluid">
        <div class="row my-4">
            <div class="col-12">
                {% if trucks_info %}
                    <div class="truck-cards-container">
                        {% for truck in trucks_info %}
                            <div class="card truck-card">
                                <div class="card-body">
                                    <h5 class="card-title">Camión {{ truck.truck_number }}</h5>
                                    <p><strong>Día de inicio de reparto:</strong> {{ truck.start_date }}</p>
                                    <p><strong>Días totales de la ruta:</strong> {{ truck.total_days }}</p>
                                    
                                    <!-- Botón para togglear la información detallada -->
                                    <button class="btn btn-primary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTruck_{{ truck.truck_number }}" aria-expanded="false" aria-controls="collapseTruck_{{ truck.truck_number }}">
                                        Más información
                                    </button>
                                    
                                    <!-- Sección colapsable con la información de los días y pedidos -->
                                    <div class="collapse mt-3" id="collapseTruck_{{ truck.truck_number }}">
                                        {% for day_data in truck.daily_orders %}
                                            <h6>Día {{ day_data.day_num }}:</h6>
                                            {% if day_data.orders %}
                                                <ul class="list-group list-group-flush mb-3">
                                                {% for order in day_data.orders %}
                                                    <li class="list-group-item">
                                                        Pedido {{ order.id }} - Caduca: {{ order.expiration_date }}
                                                    </li>
                                                {% endfor %}
                                                </ul>
                                            {% else %}
                                                <p>Sin entregas este día.</p>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p>No hay camiones asignados.</p>
                {% endif %}
            </div>
        </div>
        <div class="row">
            <div class="col-12 text-center">
                <div id="map">
                    {{ map|safe }}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
